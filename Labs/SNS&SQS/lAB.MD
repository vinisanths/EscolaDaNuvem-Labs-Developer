# üöÄ Projeto de Mensageria Resiliente com AWS SNS e SQS

Este reposit√≥rio documenta a implementa√ß√£o de um sistema de mensageria desacoplado e tolerante a falhas na AWS, utilizando SNS para publica√ß√£o de eventos, SQS para consumo em filas e uma Dead-Letter Queue (DLQ) para tratamento de erros.

## üèõÔ∏è Arquitetura

O fluxo de trabalho foi desenhado para maximizar o desacoplamento e a resili√™ncia entre microsservi√ßos:

1.  **Publicador (Publisher)**: Um servi√ßo (ou usu√°rio via console AWS) publica uma mensagem em um **T√≥pico SNS Padr√£o**. 
2.  **Inscri√ß√£o (Subscription)**: Uma **Fila SQS Principal** est√° inscrita neste t√≥pico SNS, recebendo todas as mensagens publicadas. 
3.  **Processamento Falho (Simula√ß√£o)**: Um consumidor tenta processar uma mensagem da fila principal, mas falha repetidamente.
4.  **Pol√≠tica de Redirecionamento (Redrive Policy)**: Ap√≥s um n√∫mero pr√©-configurado de tentativas de leitura falhas (ex: 3 vezes), a Fila SQS Principal move automaticamente a mensagem "envenenada" para uma segunda fila. 
5.  **An√°lise de Falhas**: A mensagem √© isolada na **Fila de Mensagens Mortas (Dead-Letter Queue - DLQ)**, onde pode ser analisada por uma equipe de desenvolvimento sem impactar o fluxo principal de mensagens. 

```mermaid
graph TD;
    A[Publicador] -- Publica Mensagem --> B(T√≥pico SNS);
    B -- Envia para Assinante --> C{Fila SQS Principal};
    C -- Leitura Bem-sucedida --> D[Consumidor Processa ‚úÖ];
    C -- Falhas Repetidas --> E{Fila DLQ üíÄ};
    E -- An√°lise de Erro --> F[Equipe de Dev üë®‚Äçüíª];
```

## üõ†Ô∏è Configura√ß√£o do Ambiente

Este projeto foi constru√≠do inteiramente no Console de Gerenciamento da AWS. Os seguintes recursos foram criados e configurados:

### 1. Filas SQS

-   **Fila DLQ (`minha-dlq-lab-...`)**: Uma fila SQS Padr√£o simples, criada primeiro para que seu ARN pudesse ser utilizado na fila principal. 
-   **Fila Principal (`minha-fila-principal-lab-...`)**: Uma fila SQS Padr√£o com a se√ß√£o **Dead-letter queue** habilitada e configurada para: 
    -   Apontar para o ARN da nossa DLQ. 
    -   Definir o `Maximum receives` para `3`. 

### 2. T√≥pico SNS

-   **T√≥pico (`meu-topico-lab-...`)**: Um T√≥pico SNS Padr√£o foi criado para servir como o ponto central de publica√ß√£o de eventos. 

### 3. Conex√£o e Permiss√µes

-   **Inscri√ß√£o SNS**: A Fila SQS Principal foi inscrita no T√≥pico SNS. 
-   **Pol√≠tica de Acesso da Fila SQS**: Uma pol√≠tica JSON foi anexada √† fila principal para permitir explicitamente que o servi√ßo SNS (`sns.amazonaws.com`) executasse a a√ß√£o `sqs:SendMessage`, condicionada ao ARN do nosso t√≥pico.

    <details>
    <summary>Clique para ver o exemplo da Pol√≠tica JSON</summary>

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "Allow-SNS-SendMessage",
          "Effect": "Allow",
          "Principal": {
            "Service": "sns.amazonaws.com"
          },
          "Action": "sqs:SendMessage",
          "Resource": "<ARN_DA_FILA_PRINCIPAL>",
          "Condition": {
            "ArnEquals": {
              "aws:SourceArn": "<ARN_DO_T√ìPICO_SNS>"
            }
          }
        }
      ]
    }
    ```
    </details>

## üß™ Como Testar

### Teste 1: Fluxo Feliz

1.  Acesse o Console SNS e selecione o t√≥pico criado.
2.  Clique em **"Publicar mensagem"**. 
3.  Envie uma mensagem JSON de teste.
4.  Acesse o Console SQS, selecione a **fila principal** e clique em **"Sondar mensagens"**. 
5.  **Resultado esperado**: A mensagem publicada via SNS deve aparecer na fila SQS. 

### Teste 2: Simula√ß√£o de Falha e Envio para a DLQ

1.  Certifique-se de que a mensagem do teste anterior ainda est√° na fila (ou publique uma nova).
2.  Na fila principal, clique em **"Sondar mensagens"** para visualizar a mensagem. **N√£o a exclua**.  O contador de recebimentos (`Receive count`) ser√° `1`. 
3.  Aguarde o tempo limite de visibilidade da fila (padr√£o: 30 segundos) expirar. 
4.  Sonde as mensagens novamente. O `Receive count` ser√° `2`. 
5.  Repita o processo. Na terceira sondagem, o `Receive count` ser√° `3`. 
6.  Ap√≥s o tempo limite de visibilidade expirar mais uma vez, a mensagem desaparecer√° da fila principal. 
7.  **Resultado esperado**: Navegue at√© a **fila DLQ**, sonde as mensagens e a mensagem original estar√° l√°, pronta para inspe√ß√£o. 

## üßπ Limpeza

> **Importante**: Para evitar custos inesperados, lembre-se de excluir todos os recursos criados ao final dos testes.

1.  Exclua a **Assinatura SNS**. 
2.  Exclua o **T√≥pico SNS**. 
3.  Exclua a **Fila SQS Principal**. 
4.  Exclua a **Fila SQS DLQ**.